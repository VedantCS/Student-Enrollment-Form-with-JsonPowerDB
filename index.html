<!DOCTYPE html>
<html lang="en">
<head>
     <meta charset="UTF-8">
    <meta name="viewport"="width=device-width, initial-scale=1.0">
    <title>Student Enrollment Form</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .form-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            padding: 40px;
            max-width: 600px;
            margin: 50px auto;
        }
        .form-title {
            color: #667eea;
            font-weight: bold;
            margin-bottom: 30px;
            text-align: center;
        }
        .btn-custom {
            min-width: 100px;
            margin: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="form-container">
            <h2 class="form-title">Student Enrollment Form</h2>
            <form id="studentForm" method="post">
                <div class="mb-3">
                    <label for="rollNo" class="form-label">Roll No <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="rollNo" name="rollNo" 
                           placeholder="Enter Roll Number" required>
                </div>
                
                <div class="mb-3">
                    <label for="fullName" class="form-label">Full Name <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="fullName" name="fullName" 
                           placeholder="Enter Full Name" disabled required>
                </div>
                
                <div class="mb-3">
                    <label for="class" class="form-label">Class <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="class" name="class" 
                           placeholder="Enter Class" disabled required>
                </div>
                
                <div class="mb-3">
                    <label for="birthDate" class="form-label">Birth Date <span class="text-danger">*</span></label>
                    <input type="date" class="form-control" id="birthDate" name="birthDate" 
                           disabled required>
                </div>
                
                <div class="mb-3">
                    <label for="address" class="form-label">Address <span class="text-danger">*</span></label>
                    <textarea class="form-control" id="address" name="address" rows="3" 
                              placeholder="Enter Address" disabled required></textarea>
                </div>
                
                <div class="mb-3">
                    <label for="enrollmentDate" class="form-label">Enrollment Date <span class="text-danger">*</span></label>
                    <input type="date" class="form-control" id="enrollmentDate" name="enrollmentDate" 
                           disabled required>
                </div>
                
                <div class="text-center mt-4">
                    <button type="button" id="saveBtn" class="btn btn-success btn-custom" 
                            onclick="saveData()" disabled>Save</button>
                    <button type="button" id="updateBtn" class="btn btn-primary btn-custom" 
                            onclick="updateData()" disabled>Update</button>
                    <button type="button" id="resetBtn" class="btn btn-secondary btn-custom" 
                            onclick="resetForm()" disabled>Reset</button>
                </div>
            </form>
        </div>
    </div>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // JsonPowerDB Configuration
        const baseUrl = "http://api.login2explore.com:5577";
        const irlUrl = "/api/irl";  // For GET (Retrieve)
        const imlUrl = "/api/iml";  // For PUT/UPDATE
        
      
        const token = "90934817|-31949261962530760|90958328";
        const dbName = "SCHOOL-DB";
        const relationName = "STUDENT-TABLE";
        // Store record number for updates
        let currentRecNo = null;
         // Initialize form on page load
        $(document).ready(function() {
            resetForm();
            $('#rollNo').focus();
        });
         // Handle Roll No field blur event
        $('#rollNo').on('blur', function() {
            const rollNo = $('#rollNo').val();
            if (rollNo !== '') {
                checkRollNoExists(rollNo);
            }
        });
         // Check if Roll No exists in database
        function checkRollNoExists(rollNo) {
            const jsonStr = {
                "Roll-No": rollNo
            };
            
            const reqString = JSON.stringify({
                token: token,
                cmd: "GET",
                dbName: dbName,
                rel: relationName,
                jsonStr: jsonStr
            });
             $.ajax({
                type: "POST",
                url: baseUrl + irlUrl,
                data: reqString,
                success: function(result) {
                    const data = JSON.parse(result);
                    if (data.status === 200 && data.data) {
                        // Record exists - populate form for update
                        const record = JSON.parse(data.data);
                        populateForm(record.record);
                        currentRecNo = record.rec_no;
                        enableUpdateMode();
                    } else if (data.status === 400) {
                        // Record doesn't exist - enable save mode
                        enableSaveMode();
                    }
                },
                error: function(xhr, status, error) {
                    // Record not found - enable save mode
                    enableSaveMode();
                }
            });
        }
         // Populate form with existing data
        function populateForm(data) {
            $('#fullName').val(data["Full-Name"]);
            $('#class').val(data["Class"]);
            $('#birthDate').val(data["Birth-Date"]);
            $('#address').val(data["Address"]);
            $('#enrollmentDate').val(data["Enrollment-Date"]);
        }
        
        // Enable Save mode (new record)
        function enableSaveMode() {
            $('#rollNo').prop('disabled', true);
            enableFormFields();
            $('#saveBtn').prop('disabled', false);
            $('#updateBtn').prop('disabled', true);
            $('#resetBtn').prop('disabled', false);
            $('#fullName').focus();
        }
        
        // Enable Update mode (existing record)
        function enableUpdateMode() {
            $('#rollNo').prop('disabled', true);
            enableFormFields();
            $('#saveBtn').prop('disabled', true);
            $('#updateBtn').prop('disabled', false);
            $('#resetBtn').prop('disabled', false);
            $('#fullName').focus();
        }
        
        // Enable all form fields except Roll No
        function enableFormFields() {
            $('#fullName').prop('disabled', false);
            $('#class').prop('disabled', false);
            $('#birthDate').prop('disabled', false);
            $('#address').prop('disabled', false);
            $('#enrollmentDate').prop('disabled', false);
        }
        
        // Disable all form fields except Roll No
        function disableFormFields() {
            $('#fullName').prop('disabled', true);
            $('#class').prop('disabled', true);
            $('#birthDate').prop('disabled', true);
            $('#address').prop('disabled', true);
            $('#enrollmentDate').prop('disabled', true);
        }
        